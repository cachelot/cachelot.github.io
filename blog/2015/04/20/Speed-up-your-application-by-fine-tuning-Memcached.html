<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Memcached Performance Tuning</title> <meta http-equiv="content-type" content="text/html; charset=utf-8" /> <meta name="description" content="Cachelot - C++ LRU cache library and memory efficient KV object storage" /> <meta name="keywords" content="Cachelot, LRU, cache, Memcached, distributed cache, high-performance, C++" /> <meta name="description" content="Memcached is often threated as a zero-configuration system. This isn’t quite true.Proper configuration to the hardware and client application’s behavior can ..." /> <link rel="canonical" href="https://www.cachelot.io/blog/2015/04/20/Speed-up-your-application-by-fine-tuning-Memcached.html"> <link rel="alternate" type="application/rss+xml" title="Cachelot - C++ LRU cache library and memory efficient key-value server" href="/feed.xml" /> <link rel="icon" type="image/png" href="/favicon96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="/favicon32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/favicon16x16.png" sizes="16x16"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="icon" href="/favicon.ico" type="image/x-icon"> <link href="/assets/css/main.css" rel="stylesheet"> </head> <!---------------- BODY -------------------> <body> <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script> <div id="navbar-main" class="navbar navbar-inverse" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a href="/index.html" class="navbar-brand smoothScroll"><span id="logo_cachelot">cachelot</span><span id="logo_io">.io</span></a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right" id="nav"> <li><a href="https://github.com/cachelot/cachelot"><i class="fa fa-github"></i>GitHub</a></li> <li><a href="/blog/index.html"><i class="fa fa-rss"></i>Blog</a></li> <li><a class="smoothScroll" href="/index.html#about">About</a></li> <li><a class="smoothScroll" href="/index.html#benchmarks">Benchmarks</a></li> </ul> </div> <!--/.nav-collapse --> </div> </div> <script async defer src="/assets/js/auto-hide-nav.js"></script> <div id="cachelot-logo" class="container"> <div class="row"> <img src="/assets/img/logo.png" alt="Awesome Cachelot Logo" width="256" height="256" /> <div class="centered col-sm-10 col-sm-offset-1"> <h3>Lightning-fast LRU cache library and key-value server.</h3> <p>Cachelot is free and open source. Distributed under the terms of BSD 2-Clause "Simplified" License.</p> </div> <div class="centered col-sm-10 col-sm-offset-1"> <ul class="actions"> <li><a href="https://github.com/cachelot/cachelot" class="altbtn" target="_blank"><i class="fa fa-github"></i>GitHub</a></li> <li><a href="#" class="smoothScroll btn"><i class="fa fa-caret-down"></i>Continue</a></li> </ul> </div> </div> </div> <div class="container"> <div class="row"> <article class="post col-lg-8 col-lg-offset-2 col-xs-10 col-xs-offset-1"> <header class="post-header centered"> <h1 class="post-title">Memcached Performance Tuning</h1> <p class="post-meta">Apr 20, 2015</p> <img class="title-image" src="/assets/img/blog/fine-tuning-memcached.jpg" alt="Memcached Performance Tuning" /> </header> <section class="post-content"> <p>Memcached is often threated as a zero-configuration system. This isn’t quite true. Proper configuration to the hardware and client application’s behavior can significantly improve overall performance.</p> <p>Memcached is pretty simple, and there is a handful of statistics. You only need to know a bit of internals to use it. Luckily, it’s not a complicated thing at all.</p> <p>As usual, there is no silver bullet. You’re free to experiment. I even encourage you to do this.</p> <h2 id="stats">Stats</h2> <p>The starting point of performance tuning is the stats. The easiest way to see stats is to connect to the Memcached server with telnet and run <code class="highlighter-rouge">stats</code> in the telnet console.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ telnet localhost 11211
Connected to localhost.
Escape character is '^]'.
telnet&gt; stats

STAT pid 12950
STAT uptime 55
STAT time 1429483226
STAT version 1.4.15
STAT libevent 2.0.21-stable
STAT pointer_size 64
STAT rusage_user 4.758163
STAT rusage_system 8.206732
STAT curr_connections 10
STAT total_connections 123
STAT connection_structures 42
STAT reserved_fds 20
...
</code></pre></div></div> <h3 id="command-hits--misses">Command Hits / Misses</h3> <p>There are number of hits/misses stats for every command, and these can reveal problems in application behavior. For instance, an application may aggressively cache short-living or rarely used objects, causing a hight rate of misses and evictions. The rule of thumb here is to keep the cache miss ratio close to zero.</p> <h3 id="evictions">Evictions</h3> <p>One of the most important stats is <code class="highlighter-rouge">evictions</code>. It is the number of non-expired Items that were removed from the cache to free up space for new items.</p> <p>A high number of evictions may indicate that applications overuse the cache or that the amount of memory allocated for Items storage is not sufficient. The maximum amount of memory used to store Items can be increased by the -m command-line argument (default value is 64Mb).</p> <h3 id="connection-yields">Connection Yields</h3> <p>The number of times when a connection was yielded during batch execution.</p> <p>The slowest part of the request execution is the network roundtrip. The application should use batching to achieve maximum performance. Several write requests can be combined into a single network IO operation. Read operations should utilize multi-key requests.</p> <p>The downside of using batches is possible connection starvation - the situation when one connection is forced to wait until another finishes its batch. Memcached limits the number of requests per single network IO operation to prevent starvation. Every time a connection tries to execute a batch bigger than this limit; Memcached moves this connection to the back of the processing queue and increments the <code class="highlighter-rouge">conn_yields</code> stat.</p> <p>The command-line parameter <code class="highlighter-rouge">-R</code> is in charge of the maximum number of requests per network IO event (default value is 20). The application should adopt its batch size according to this parameter. Please note that the requests limit does not affect multi-key reads, or the number of keys per get request.</p> <h2 id="other-command-line-arguments">Other Command-line Arguments</h2> <h3 id="number-of-threads">Number of threads</h3> <p>The most important setting influenced overall performance: number of threads <code class="highlighter-rouge">-t</code>. The default value of 4 is a good choice for almost every setup. Avoid using more than eight threads, it leads to high lock contention inside of Memcached and performance degrade.</p> <p>A configuration with a single thread should never be used, even on a single-core machine.</p> <h3 id="disable-use-of-cas">Disable use of CAS</h3> <p>A compare-and-swap operation of Memcached requires a separate Item field to store unique CAS values. It takes an additional 8 bytes of memory per Item. If CAS operation is not used by your application, <code class="highlighter-rouge">-C</code> flag can save some memory.</p> <h3 id="memcached-as-in-memory-storage">Memcached as In-memory Storage</h3> <p>There is <code class="highlighter-rouge">-M</code> argument that tells Memcached to reply with an error when out-of-memory instead of evicting existing items. In that way, it’s possible to use Memcached as a consistent in-memory storage.</p> <h2 id="general-advices">General Advices</h2> <p>Use the pool of long-living connections to the server. Memcached is designed to serve many connections simultaneously and with tens of connections you will achieve much better performance.</p> <p>Store Items over TCP, retrieve over UDP. As was said: the network transportation is a main source of delays. On a high data volume, TCP packet size overhead can significantly impact overall performance.</p> <h4 id="share-your-memcached-tips-in-thecomments"><em>Share your Memcached tips in the comments.</em></h4> </section> </article> </div> </div> <div class="container"> <div id="social-buttons" class="row"> <ul> <li><a href="https://www.cachelot.io/feed.xml"><i class="fa fa-rss"></i></a></li> <li><a href="https://facebook.com/cachelot.io"><i class="fa fa-facebook"></i></a></li> <li><a href="https://twitter.com/cachelot_io"><i class="fa fa-twitter"></i></a></li> <li><a href="https://github.com/cachelot/cachelot"><i class="fa fa-github"></i></a></li> </ul> </div> <div id="copyright" class="row centered"> Copyright &copy; 2016 <a href="https://www.cachelot.io">cachelot.io</a>. Logo design by <a href="https://www.behance.net/arttolstykh">arttolstykh</a>. Hosted on <a href="https://pages.github.com/">GitHub Pages</a> </div> </div> <script type="text/javascript" src="/assets/js/smoothscroll.js"></script> <script> (function (i, s, o, g, r, a, m) {i['GoogleAnalyticsObject'] = r;i[r] = i[r] || function () {(i[r].q = i[r].q || []).push(arguments)}, i[r].l = 1 * new Date();a = s.createElement(o), m = s.getElementsByTagName(o)[0];a.async = 1;a.src = g;m.parentNode.insertBefore(a, m)})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-59820172-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.2/cookieconsent.min.css" /> <script async defer src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.2/cookieconsent.min.js"></script> <script> window.addEventListener("load", function(){ window.cookieconsent.initialise({ type: "info", palette: { popup: { "background": "#292f33" }, button: { "background": "#3e6a7d" } }, content: { message: "This website relies on third-party services that use cookies.", dismiss: "Got it!", link: "Learn more", href: "http://cookiesandyou.com", policy: "Cookie Policy", target: "_blank" }, law: { regionalLaw: false, }, })}); </script> </body> </html>
